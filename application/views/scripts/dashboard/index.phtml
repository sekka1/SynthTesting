<?php ?>
<? //require_once realpath(dirname(__FILE__).'/inc/config.php'); ?>
<? require_once ('AlgorithmsIO/config.php'); ?>
<? 
//$wizard_height="500px";
global $GLOBALS;
//$GLOBALS["htmllinktags"] = <<<EOS
$htmllinktags = <<<EOS
<link rel="stylesheet" href="/css/dashboard.css">
<!-- Bootstrap CSS Toolkit styles -->
<link rel="stylesheet" href="/css/fileupload/bootstrap.min.css">
<!-- Bootstrap styles for responsive website layout, supporting different screen sizes -->
<link rel="stylesheet" href="/css/fileupload/bootstrap-responsive.min.css">
<!-- Bootstrap CSS fixes for IE6 -->
<!--[if lt IE 7]><link rel="stylesheet" href="/css/fileupload/bootstrap-ie6.min.css"><![endif]-->
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="/css/fileupload/jquery.fileupload-ui.css">
<!-- Shim to make HTML5 elements usable in older Internet Explorer versions -->
<!--[if lt IE 9]><script src="/js/html5.js"></script><![endif]-->

<link rel="stylesheet" type="text/css" href="/css/flexigrid/flexigrid.pack.css" />
<link rel="stylesheet" type="text/css" href="/inc/jqGrid/css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" href="/css/algotheme/jquery-ui-1.9.2.custom.css" />
<link rel="stylesheet" type="text/css" href="/css/overrides.css" /><!-- Should be the last item -->
EOS;
#<!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

$API_JS = $this->API_URL."Jssdk/?authToken=".$this->token;
$VIS_JS = $this->API_URL."JsLibrary/";
$API_Access_Counts = $this->API_URL."Credits/APIAccesses?authToken=".$this->token;
$javascript = <<<EOS
<script type="text/javascript" src="/bootstrap/js/bootstrap.js"></script>
<script type="text/javascript" src="$API_JS"></script>    
<script src="/js/Dashboard.js"></script>
<script src="/js/jquery.timeago.js"></script>
<script type="text/javascript" src="/inc/jqGrid/js/i18n/grid.locale-en.js" type="text/javascript"></script>
<script type="text/javascript" src="/inc/jqGrid/js/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="/js/algo_choosers.js"></script>
EOS;

$javascript .= '<script language="javascript" type="text/javascript" src="'.$VIS_JS.'visualizations/flot/jquery.flot.js?authToken='.$this->token.'"></script>';
$javascript .= '<script language="javascript" type="text/javascript" src="'.$VIS_JS.'visualizations/flot/jquery.flot.selection.js?authToken='.$this->token.'"></script>';

echo pageheader(array(
	"htmllinktags"	=>$htmllinktags,
	"javascript"	=>$javascript,
        "view"          =>$this,
        "nav_as_tabs"   =>true,
)); 

$dashboard_warning = "";

// Cycle through the localization messages to see if any warnings should be issued about credits - MRR 20120614
foreach ($this->localization->dashboard->notices->credits as $cred_notice) {
	$attribs = $cred_notice->attributes();
	$credits = $this->authentication->credits();
	if(($credits >= $attribs["min"]) && ($credits <= $attribs["max"])) {
		$dashboard_warning = "".$cred_notice;
	}
}

?>
<SCRIPT src="/js/algo.js"></script>
<SCRIPT>
$(function (){
	//$('#dashboardTabs').tab('show');
	//$('#dashboardTabs a:first').tab('show');
	//$('#algo-dash-links').tab('show');
        //$('#algo-dash-links a:first').tab('show');
        if(window.location.hash) {
            var hash = window.location.hash;
            hash = hash.toString().substr(1,hash.length);
            var switchtab = function() { 
                $('#nav_'+hash+'_tab').tab('show'); 
                setTimeout(resizeChoosers,500);
            }
            setTimeout(switchtab, 2000);            
//            alert(window.location.hash);
        } else {
            $('#algo-dash-links a:first').tab('show');
        }
        
        $('#preferences_tab').load('/preferences');
        <? if($dashboard_warning != "") { ?>
	$('#dashboardWarning').fadeIn('slow');
        <? } ?>
});
</SCRIPT>
<div id="holder" style="min-height: 600px">
<div id="dashboard_tabs">

<div class="tab-content" zid="dashboard_tabs">
  <div class="tab-pane fade active" id="dashboard_tab" style="min-height: 500px;">

<DIV id="dashboardWarning" class="well btn-danger" style="border-color: #005 #eef #eef #005; box-shadow:inset 1px 1px 3px #333; display: none;"><a class="close" data-dismiss="alert" href="javascript:void(0);" onClick="$('#no_download_available').fadeOut('slow');">x</a><IMG SRC="/images/glyphicons/glyphicons_196_circle_exclamation_mark.png">&nbsp;<?=$dashboard_warning?></DIV>

<? if ($this->security->canRead("Dashboards")) { ?>
<? if ($this->security->canEdit("Dashboards")) { ?>
	<div class="button-general"><a href="/dashboard/editdashboard"><img src="/images/glyphicons/glyphicons_086_display_white.png" class="button-general-icon"><?=$this->localization->buttons->EditDashboardtext; ?></a></div>
        <div class="button-spacer"></div>
<? } ?>
<BR clear=all><BR clear=all> 

<?
    $api_graph_hack = <<<EOS
    <div id="graph_placeholder" style="width:902px;height:300px;"></div>
    <div id="graph_overview" style="margin: 0px auto;margin-top:20px;width:400px;height:50px"></div>
EOS;
    $dashboard_items = array(
      0=>array("title"=>"Username", "content"=>$this->username),  
      1=>array("title"=>"Auth Token", "content"=>$this->usersAuthTokens[0]['token']),
      2=>array("title"=>"Credits", "content"=>$this->authentication->credits() ." Remaining"),        
      3=>array("title"=>"Data Sources", "content"=>count($this->user->get_created_datasources())),  //FIXME: These should be bucket_datasources() - MRR20120830
      4=>array("title"=>"Algorithms", "content"=>count($this->user->get_created_algorithms())),     //FIXME: These should be bucket_algorithms() - MRR20120830
      5=>array("title"=>"Workflows", "content"=>count($this->user->get_created_flows())),           //FIXME: These should be bucket_workflows() - MRR20120830         
      6=>array("title"=>"Algorithms.io Usage", "content"=>$api_graph_hack),  
    );
?>
<DIV id="div_AccountAtAGlance" class="well" style="position: relative;">
    <h1>Your Account at a Glance</h1>
    <BR>
<? for($i=0; $i<count($dashboard_items); $i++) { 
        $item = $dashboard_items[$i];
?>    
    <DIV class="dashboard_account_item">
        <DIV class="title icon"><?=$item["title"];?></DIV>
        <DIV class="content"><?=$item["content"];?></DIV>
    </DIV>
<?}?>
    <DIV style="clear:both;"></DIV> <!-- Used to keep everything within the table -->
</DIV>

<? include_once('api_calls_graph.php'); ?>
    
<!-- BEGIN Draggable Dashboard Area
<SCRIPT>
$(function() {
	$("#dashboardDragArea").sortable({
		revert: true,
	});
});
</SCRIPT>
<DIV id="dashboardDragAreaBox" style="width:100%">
	<UL id="dashboardDragArea">
		<LI class="ui-state-default">Widget1</LI>
		<LI class="ui-state-default" style="width: 200px">Widget2</LI>
		<LI class="ui-state-default">Widget3</LI>
		<LI class="ui-state-default">Widget4</LI>
		<LI class="ui-state-default" style="height: 200px">Widget5</LI>
		<LI class="ui-state-default">Widget6</LI>
		<LI class="ui-state-default">Widget7</LI>
		<LI class="ui-state-default" style="width: 200px">Widget8</LI>
		<LI class="ui-state-default">Widget9</LI>
	</UL>
	<DIV id="blah" style="float: left; width: 100px; height: 100px; border: 1px solid #f0f;">Hello1</DIV>
	<DIV id="blahx" style="float: left; width: 100px; height: 100px; border: 1px solid #f0f;">Hello2</DIV>
	<DIV id="blah3" style="float: left; width: 100px; height: 100px; border: 1px solid #f0f;">Hello3</DIV>
</DIV>
-->
<!-- END Draggable Dashboard Area -->
<BR><BR>
<? } ?>
  </div>
  <div class="tab-pane fade in active" id="datasources_tab" style="min-height: 500px;">
<!-- *************************** BEGIN Data Sources List ********************************************* -->
<? if ($this->security->canRead("DataSources")) { include_once("datasources_list.php"); } ?>
<!-- *************************** END Data Sources List ********************************************* -->
  </div>
  <div class="tab-pane fade" id="algorithms_tab" style="min-height: 500px;">
<!-- *************************** BEGIN Algorithms List ********************************************* -->
<? if ($this->security->canRead("Algorithms")) { include_once("algorithms_list.php"); } ?>
<!-- *************************** END Algorithms List ********************************************* -->
  </div>
  <div class="tab-pane fade" id="visualizations_tab" style="min-height: 500px;">
<!-- *************************** BEGIN Interfaces List ********************************************* -->
<? if ($this->security->canRead("Visualizations")) { include_once("visualizations_list.php"); } ?>
<!-- *************************** END Interfaces List ********************************************* -->
  </div>
  <div class="tab-pane fade" id="workflows_tab" style="min-height: 500px;">
<!-- *************************** BEGIN Workflows List ********************************************* -->
<? if ($this->security->canRead("Flows")) { include_once("workflows_list.php"); } ?>
<!-- *************************** END Workflows List ********************************************* -->
  </div>
  <div class="tab-pane fade" id="jobs_tab" style="min-height: 500px;">
<!-- *************************** BEGIN Jobs List ********************************************* -->
<? if ($this->security->canRead("Jobs")) { include_once("jobs_list.php"); } ?>
<!-- *************************** END Jobs List ********************************************* -->
  </div>
  <div class="tab-pane fade" id="results_tab" style="min-height: 500px;">
<!-- *************************** BEGIN Results List ********************************************* -->
<? if ($this->security->canRead("Results")) { include_once("results_list.php"); } ?>
<!-- *************************** END Results List ********************************************* -->
  </div>

<!-- *************************** BEGIN Results List ********************************************* -->
    <div class="tab-pane fade" id="preferences_tab" style="min-height: 500px;">
        <h1>Loading....</h1>
    </div>
</div>
</div> <!-- END dashboard_tabs -->
</div> <!-- END holder -->
<? include_once("wizard_AddDataSource.php"); ?>
<BR><BR>
<? echo pagefooter(); ?>
